# GCE-Math &nbsp; [![Build Status](https://travis-ci.org/kthohr/gcem.svg?branch=master)](https://travis-ci.org/kthohr/gcem) [![Coverage Status](https://codecov.io/github/kthohr/gcem/coverage.svg?branch=master)](https://codecov.io/github/kthohr/gcem?branch=master)

## About

GCE-Math (**G**eneralized **C**onstant **E**xpression Math) is a templated C++ library for compile-time computation of mathematical functions.

* GCE-Math makes extensive use of recursive templates and ```constexpr``` functions to perform continued fraction and series-type expansions of special mathematical functions.
* The library is written in a concise C++11 ```constexpr``` format, and is C++11/14/17 compatible.
* The ```gcem::``` syntax is identical to that of the C++ standard library.
* Tested and accurate to machine precision against the C++ standard library.

## Status

The library is actively maintained, and is still being extended.

A list of features includes:

* basic standard library functions, such as:
    - ```abs```, ```exp```, ```log```, ```max```, ```min```, ```pow```, ```sqrt```
* trigonometric functions:
    - basic: ```cos```, ```sin```, ```tan```
    - inverse: ```acos```, ```asin```, ```atan```
    - hyperbolic (area) functions: ```cosh```, ```sinh```, ```tanh```, ```acosh```, ```asinh```, ```atanh```
* special functions:
    - factorials and the binomial coefficient: ```factorial```, ```binomial_coef```
    - beta and gamma functions: ```beta```, ```lbeta```, ```lgamma```, ```tgamma```
    - the Gaussian error function and inverse error function: ```erf```, ```erf_inv```
    - (regularized) incomplete beta and incomplete gamma functions: ```incomplete_beta```, ```incomplete_gamma```
    - inverse incomplete beta and incomplete gamma functions: ```incomplete_beta_inv```, ```incomplete_gamma_inv```

## Syntax

GCE-Math functions are written as C++ templates which might be confusing for users unfamiliar with template programming. For example, the [Gaussian error function](https://en.wikipedia.org/wiki/Error_function) (```erf```) is defined as:
```cpp
template<typename T>
constexpr
T
erf(const T x)
```
where a series of internal templated ```constexpr``` functions implement a recursive continued fraction expansion. Note that the output type ('```T```') in this example is determined by the input type, e.g., ```float```, ```double```, ```long double```, etc. So take care when passing integral-type inputs and use recasts where appropriate.


## Installation

GCE-Math is a header-only library and does not require any additional libraries (beyond a C++11 compatible compiler). 

Simply include the gcem header files with your project.

## Examples

To calculate 10!:

```cpp
#include "gcem.hpp"

int main()
{
    constexpr int x = 10;
    constexpr int res = gcem::factorial(x);

    return 0;
}
```
Inspecting the assembly code generated by Clang:
```assembly
_main:                                  ## @main
	.cfi_startproc
## BB#0:
	push	rbp
Lcfi0:
	.cfi_def_cfa_offset 16
Lcfi1:
	.cfi_offset rbp, -16
	mov	rbp, rsp
Lcfi2:
	.cfi_def_cfa_register rbp
	xor	eax, eax
	mov	dword ptr [rbp - 4], 0
	mov	dword ptr [rbp - 8], 10
	mov	dword ptr [rbp - 12], 3628800
	pop	rbp
	ret
	.cfi_endproc
```
We see that a function call has been replaced by the answer (10! = 3628800).

Similarly, to compute the log Gamma function at a point:

```cpp
#include "gcem.hpp"

int main()
{
    constexpr long double x = 1.5;
    constexpr long double res = gcem::lgamma(x);

    return 0;
}
```
Assembly code:
```assembly
LCPI0_0:
	.long	1069547520              ## float 1.5
	.section	__TEXT,__literal16,16byte_literals
	.p2align	4
LCPI0_1:
	.quad	-622431863250851168     ## x86_fp80 -0.120782237635245167208
	.short	49147
	.space	6
	.section	__TEXT,__text,regular,pure_instructions
	.globl	_main
	.p2align	4, 0x90
_main:                                  ## @main
	.cfi_startproc
## BB#0:
	push	rbp
Lcfi0:
	.cfi_def_cfa_offset 16
Lcfi1:
	.cfi_offset rbp, -16
	mov	rbp, rsp
Lcfi2:
	.cfi_def_cfa_register rbp
	xor	eax, eax
	mov	dword ptr [rbp - 4], 0
	fld	dword ptr [rip + LCPI0_0]
	fstp	xword ptr [rbp - 32]
	fld	xword ptr [rip + LCPI0_1]
	fstp	xword ptr [rbp - 48]
	pop	rbp
	ret
	.cfi_endproc
```


To build the full test suite:

```bash
# clone gcem from GitHub
git clone -b master --single-branch https://github.com/kthohr/gcem ./gcem
# compile tests
cd ./gcem/tests
make
./run_tests
```

## Related libraries

For a library built on the GCEM compile-time functionality, see [StatsLib](https://github.com/kthohr/stats).

## Author

Keith O'Hara

## License

Apache Version 2
